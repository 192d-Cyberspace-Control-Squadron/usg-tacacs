# SPDX-License-Identifier: Apache-2.0
# PgBouncer connection pooler configuration
---
# Pool settings
pgbouncer_pool_mode: transaction
pgbouncer_max_client_conn: 1000
pgbouncer_default_pool_size: 20

# Databases - connect to Patroni leader (via HAProxy or direct)
pgbouncer_databases:
  - name: tacacs_policy
    host: "{{ patroni_leader_host | default(groups['patroni'][0]) }}"
    port: 5432
    dbname: tacacs_policy
    pool_size: 20
    pool_mode: transaction

# Users (passwords should come from Vault)
pgbouncer_users:
  - name: tacacs_policy
    password: "{{ vault_tacacs_policy_db_password }}"
  - name: pgbouncer
    password: "{{ vault_pgbouncer_admin_password }}"

# Admin users
pgbouncer_admin_users: pgbouncer
pgbouncer_stats_users: pgbouncer

# Timeouts
pgbouncer_server_lifetime: 3600
pgbouncer_server_idle_timeout: 600
pgbouncer_query_wait_timeout: 120
