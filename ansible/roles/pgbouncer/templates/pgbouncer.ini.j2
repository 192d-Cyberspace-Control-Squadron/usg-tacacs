# SPDX-License-Identifier: Apache-2.0
# PgBouncer configuration for PostgreSQL connection pooling
# Managed by Ansible - do not edit manually

[databases]
{% for db in pgbouncer_databases %}
{{ db.name }} = host={{ db.host }} port={{ db.port | default(5432) }} dbname={{ db.dbname | default(db.name) }}{% if db.pool_size is defined %} pool_size={{ db.pool_size }}{% endif %}{% if db.pool_mode is defined %} pool_mode={{ db.pool_mode }}{% endif %}

{% endfor %}

[pgbouncer]
; Connection settings
listen_addr = {{ pgbouncer_listen_addr }}
listen_port = {{ pgbouncer_listen_port }}
unix_socket_dir = {{ pgbouncer_run_dir }}

; Authentication
auth_type = {{ pgbouncer_auth_type }}
auth_file = {{ pgbouncer_auth_file }}
{% if pgbouncer_auth_query %}
auth_query = {{ pgbouncer_auth_query }}
{% endif %}

; Admin access
admin_users = {{ pgbouncer_admin_users }}
stats_users = {{ pgbouncer_stats_users }}

; Pool settings
pool_mode = {{ pgbouncer_pool_mode }}
max_client_conn = {{ pgbouncer_max_client_conn }}
default_pool_size = {{ pgbouncer_default_pool_size }}
min_pool_size = {{ pgbouncer_min_pool_size }}
reserve_pool_size = {{ pgbouncer_reserve_pool_size }}
reserve_pool_timeout = {{ pgbouncer_reserve_pool_timeout }}
max_db_connections = {{ pgbouncer_max_db_connections }}
max_user_connections = {{ pgbouncer_max_user_connections }}

; Connection handling
server_reset_query = {{ pgbouncer_server_reset_query }}
server_check_delay = {{ pgbouncer_server_check_delay }}
server_check_query = {{ pgbouncer_server_check_query }}
server_lifetime = {{ pgbouncer_server_lifetime }}
server_idle_timeout = {{ pgbouncer_server_idle_timeout }}
server_connect_timeout = {{ pgbouncer_server_connect_timeout }}
server_login_retry = {{ pgbouncer_server_login_retry }}

; Client handling
client_idle_timeout = {{ pgbouncer_client_idle_timeout }}
client_login_timeout = {{ pgbouncer_client_login_timeout }}

; Query handling
query_timeout = {{ pgbouncer_query_timeout }}
query_wait_timeout = {{ pgbouncer_query_wait_timeout }}

; Logging
log_connections = {{ pgbouncer_log_connections }}
log_disconnections = {{ pgbouncer_log_disconnections }}
log_pooler_errors = {{ pgbouncer_log_pooler_errors }}
stats_period = {{ pgbouncer_stats_period }}
verbose = {{ pgbouncer_verbose }}
logfile = {{ pgbouncer_log_dir }}/pgbouncer.log
pidfile = {{ pgbouncer_run_dir }}/pgbouncer.pid

{% if pgbouncer_tls_enabled %}
; TLS settings
client_tls_sslmode = {{ pgbouncer_tls_sslmode }}
client_tls_cert_file = {{ pgbouncer_tls_cert_file }}
client_tls_key_file = {{ pgbouncer_tls_key_file }}
{% if pgbouncer_tls_ca_file %}
client_tls_ca_file = {{ pgbouncer_tls_ca_file }}
{% endif %}
{% endif %}

; Dangerous settings (don't change unless you know what you're doing)
ignore_startup_parameters = extra_float_digits
