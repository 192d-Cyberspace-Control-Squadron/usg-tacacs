# SPDX-License-Identifier: Apache-2.0
# pgbouncer - Default variables for PgBouncer connection pooling
---
# PgBouncer configuration
pgbouncer_listen_addr: "0.0.0.0"
pgbouncer_listen_port: 6432
pgbouncer_admin_users: "pgbouncer"
pgbouncer_stats_users: "pgbouncer"

# Pool configuration
pgbouncer_pool_mode: transaction  # session, transaction, statement
pgbouncer_max_client_conn: 1000
pgbouncer_default_pool_size: 20
pgbouncer_min_pool_size: 5
pgbouncer_reserve_pool_size: 5
pgbouncer_reserve_pool_timeout: 5
pgbouncer_max_db_connections: 100
pgbouncer_max_user_connections: 100

# Connection settings
pgbouncer_server_reset_query: "DISCARD ALL"
pgbouncer_server_check_delay: 30
pgbouncer_server_check_query: "SELECT 1"
pgbouncer_server_lifetime: 3600
pgbouncer_server_idle_timeout: 600
pgbouncer_server_connect_timeout: 15
pgbouncer_server_login_retry: 15
pgbouncer_client_idle_timeout: 0
pgbouncer_client_login_timeout: 60
pgbouncer_query_timeout: 0
pgbouncer_query_wait_timeout: 120

# Authentication
pgbouncer_auth_type: scram-sha-256  # trust, md5, scram-sha-256, cert
pgbouncer_auth_file: /etc/pgbouncer/userlist.txt
pgbouncer_auth_query: "SELECT usename, passwd FROM pg_shadow WHERE usename=$1"

# Databases (connect to Patroni cluster via HAProxy or direct)
pgbouncer_databases: []
# Example:
# pgbouncer_databases:
#   - name: tacacs_policy
#     host: 127.0.0.1  # HAProxy VIP or Patroni leader
#     port: 5432
#     dbname: tacacs_policy
#     pool_size: 20
#     pool_mode: transaction

# Users for authentication
pgbouncer_users: []
# Example:
# pgbouncer_users:
#   - name: tacacs_policy
#     password: "scram-sha-256$..."  # Use scram-sha-256 hash
#   - name: pgbouncer
#     password: "scram-sha-256$..."

# Logging
pgbouncer_log_connections: 1
pgbouncer_log_disconnections: 1
pgbouncer_log_pooler_errors: 1
pgbouncer_stats_period: 60
pgbouncer_verbose: 0

# TLS (optional)
pgbouncer_tls_enabled: false
pgbouncer_tls_cert_file: ""
pgbouncer_tls_key_file: ""
pgbouncer_tls_ca_file: ""
pgbouncer_tls_sslmode: prefer  # disable, allow, prefer, require, verify-ca, verify-full

# User/group
pgbouncer_user: pgbouncer
pgbouncer_group: pgbouncer

# Directories
pgbouncer_conf_dir: /etc/pgbouncer
pgbouncer_log_dir: /var/log/pgbouncer
pgbouncer_run_dir: /var/run/pgbouncer

# Firewall
pgbouncer_configure_firewall: true
