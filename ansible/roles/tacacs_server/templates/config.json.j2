{# SPDX-License-Identifier: Apache-2.0 #}
{# tacacs_server - Configuration template #}
{
  "shared_secret": "{{ tacacs_shared_secret }}",
  "listen_legacy": "{{ tacacs_listen_address }}:{{ tacacs_legacy_port }}",
{% if tacacs_tls_enabled | bool %}
  "listen_tls": "{{ tacacs_listen_address }}:{{ tacacs_tls_port }}",
  "tls_cert": "{{ tacacs_tls_cert_file }}",
  "tls_key": "{{ tacacs_tls_key_file }}",
  "tls_client_ca": "{{ tacacs_tls_ca_file }}",
{% if tacacs_tls_extra_roots | length > 0 %}
  "tls_extra_roots": {{ tacacs_tls_extra_roots | to_json }},
{% endif %}
{% endif %}
  "listen_http": "{{ tacacs_http_address }}:{{ tacacs_http_port }}",
  "policy_file": "{{ tacacs_policy_file }}",
{% if tacacs_ldap_enabled | bool %}
  "ldap": {
    "url": "{{ tacacs_ldap_url }}",
    "bind_dn": "{{ tacacs_ldap_bind_dn }}",
    "bind_password": "{{ tacacs_ldap_bind_password }}",
    "search_base": "{{ tacacs_ldap_search_base }}",
    "username_attr": "{{ tacacs_ldap_username_attr }}",
    "group_attr": "{{ tacacs_ldap_group_attr }}",
{% if tacacs_ldap_required_groups | length > 0 %}
    "required_group": {{ tacacs_ldap_required_groups | to_json }},
{% endif %}
    "timeout_ms": {{ tacacs_ldap_timeout_ms }}
  },
{% endif %}
  "ascii": {
    "attempt_limit": {{ tacacs_ascii_attempt_limit }},
    "user_attempt_limit": {{ tacacs_ascii_user_attempt_limit }},
    "pass_attempt_limit": {{ tacacs_ascii_pass_attempt_limit }},
    "backoff_ms": {{ tacacs_ascii_backoff_ms }},
    "backoff_max_ms": {{ tacacs_ascii_backoff_max_ms }},
    "lockout_limit": {{ tacacs_ascii_lockout_limit }}
  },
{% if tacacs_static_users | length > 0 %}
  "static_users": {
{% for user, config in tacacs_static_users.items() %}
{% if config.password_type | default('plain') == 'argon2' %}
    "{{ user }}": {
      "argon2": "{{ config.password }}"
    }{% if not loop.last %},{% endif %}

{% else %}
    "{{ user }}": {
      "plain": "{{ config.password }}"
    }{% if not loop.last %},{% endif %}

{% endif %}
{% endfor %}
  },
{% endif %}
  "location": "{{ tacacs_location }}"
}
