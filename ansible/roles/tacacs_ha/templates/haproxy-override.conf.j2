# SPDX-License-Identifier: Apache-2.0
# HAProxy systemd service override
# Managed by Ansible - do not edit manually

[Service]
# Graceful reload support
ExecReload=/usr/sbin/haproxy -c -f /etc/haproxy/haproxy.cfg
ExecReload=/bin/kill -USR2 $MAINPID

# Resource limits
LimitNOFILE=65536
LimitNPROC=4096

# Restart policy
Restart=on-failure
RestartSec=5s

# Security hardening
NoNewPrivileges=yes
ProtectSystem=strict
ProtectHome=yes
PrivateTmp=yes
PrivateDevices=yes
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectControlGroups=yes

# Allow HAProxy to bind to privileged ports
AmbientCapabilities=CAP_NET_BIND_SERVICE
CapabilityBoundingSet=CAP_NET_BIND_SERVICE

# Read-write paths needed by HAProxy
ReadWritePaths=/run/haproxy /var/lib/haproxy

# Timeout for graceful shutdown
TimeoutStopSec={{ tacacs_ha_reload_timeout }}
